#####################################
############ Directories ############
#####################################
QUAC_data_files <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_data_files"
QUAC_analysis_results <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_analyses\\Results"
setwd(QUAC_data_files)
QUAC_arp_list <- list.files(pattern = ".arp$")
library(diveRsity)
setwd(QUAC_data_files)
QUAC_arp_list <- list.files(pattern = ".arp$")
QUAC_genind_list <- list()
for(a in 1:length(QUAC_arp_list)){
QUAC_genind_list[[a]] <- arp2gen(QUAC_arp_list[[a]])
}
##create a list to convert to genind files
for(a in 1:length(QUAC_arp_list)){
arp2gen(QUAC_arp_list[[a]])
}
##now read in list of genind files
QUAC_gen_list <- list.files(pattern = ".gen$")
library(adegenet)
##loop over to load in genind files
for(g in 1:length(QUAC_gen_list)){
QUAC_genind_list[[g]] <- read.genepop(QUAC_gen_list[[a]], ncode = 3)
}
##create a list of arlequin files
QUAC_arp <- list.files(pattern = ".arp$")
##convert to genind
arp2gen(QUAC_arp)
##convert to genind
arp2gen(QUAC_arp[[1]])
QUAC_arp
#####################################
############ Directories ############
#####################################
QUAC_data_files <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_data_files"
?list.files
##create a list of arlequin files
QUAC_arp <- list.files(path = paste0(QUAC_data_files, "\\QUAC_genind"), pattern = ".arp$")
##convert to genind
arp2gen(QUAC_arp)
##convert to genind
arp2gen(QUAC_arp)
QUAC_arp
?arp2gen
setwd(paste0(QUAC_data_files, "\\QUAC_genind"))
##convert to genind
arp2gen(QUAC_arp)
##now read in genind file
QUAC_allpop_gend <- read.genepop("quac_allpop.gen", ncode = 3)
##now read in genind file
QUAC_allpop_gend <- read.genepop("quac_allpop.gen", ncode = 3)
setwd(QUAC_data_files)
##create a list of arlequin files
QUAC_arp <- list.files(path = paste0(QUAC_data_files, "\\QUAC_genind"),pattern = ".arp$")
##convert to genind
arp2gen(QUAC_arp)
paste0(QUAC_data_files, "\\QUAC_genind")
#####################################
############ Directories ############
#####################################
QUAC_data_files <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_data_files"
##create a list of arlequin files
QUAC_arp <- list.files(path = paste0(QUAC_data_files, "\\QUAC_genind"),pattern = ".arp$")
##convert to genind
arp2gen(QUAC_arp)
##create a list of arlequin files
QUAC_arp <- list.files(path = paste0(QUAC_data_files, "\\QUAC_genind\\"),pattern = ".arp$")
QUAC_arp
##convert to genind
arp2gen(paste0(QUAC_data_files, "\\QUAC_genind\\quac_allpop.arp"))
##convert to genind
arp2gen(paste0(QUAC_data_files, "\\QUAC_genind\\quac_allpop.arp"))
##now read in genind file
QUAC_allpop_gend <- read.genepop(paste0(QUAC_data_files, "\\QUAC_genind\\quac_allpop.gen"), ncode = 3)
QUAC_allpop_gend
##load files to label population names and indvidual names
QUAC_allpop_df <- read.csv(paste0(QUAC_data_files, "\\QUAC_data_frames\\QUAC_allpop_df.csv"))
View(QUAC_allpop_df)
##now read in genind file
QUAC_allpop_gen <- read.genepop(paste0(QUAC_data_files, "\\QUAC_genind\\quac_allpop.gen"), ncode = 3)
##rename individuals in the genind file
rownames(QUAC_allpop_gen@tab) <- QUAC_allpop_df$ID
##rename population names
QUAC_popnames <- unique(QUAC_allpop_df$POP)
levels(QUAC_allpop_gen@pop) <- QUAC_popnames
QUAC_allpop_gen
table(QUAC_allpop_gen@pop)
QUAC_genind_nomd <- missingno(QUAC_allpop_gen, type = "geno", cutoff = 0.25, quiet = FALSE, freq = FALSE)
library(poppr)
QUAC_genind_nomd <- missingno(QUAC_allpop_gen, type = "geno", cutoff = 0.25, quiet = FALSE, freq = FALSE)
##run clone check
QUAC_geneclone <- as.geneclone(QUAC_allpop_gen)
##run clone check
QUAC_geneclone <- as.genclone(QUAC_allpop_gen)
other(QUAC_geneclone)
strata(QUAC_geneclone)
strata(QUAC_geneclone) <- QUAC_popnames
clone_list <- mlg.id(QUAC_geneclone)
clone_list
QUAC_gen_id <- mlg.id(QUAC_geneclone)
##function to pull out all clone lists
QUAC_clone_index <- which(sapply(QUAC_gen_id,function(x) length(x)>1))
QUAC_clone_index
##now remove clones from the matrix
QUAC_noclones <- clonecorrect(QUAC_geneclone)
QUAC_noclones
##convert back to genind
QUAC_genind_nocl <- genclone2genind(QUAC_noclones)
QUAC_genind_nocl
QUAC_clone_index
QUAC_noclones
?clonecorrect
poppr(QUAC_allpop_gen)
QUAC_allpop_gen
463 - 456
QUAC_gen_id
QUAC_noclones
QUAC_clone_index
QUAC_gen_id$65
QUAC_gen_id["65"]
QUAC_gen_id["159"]
QUAC_gen_id["176"]
QUAC_gen_id["435"]
##remove individuals with too much missing data
QUAC_genind_nomd <- missingno(QUAC_allpop_gen, type = "geno", cutoff = 0.25, quiet = FALSE, freq = FALSE)
QUAC_genind_nocl
##remove individuals with too much missing data
QUAC_genind_nomd <- missingno(QUAC_genind_nocl, type = "geno", cutoff = 0.25, quiet = FALSE, freq = FALSE)
QUAC_genind_nomd
##output to genalex file
genind2genalex(genclone2genind(QUAC_genind_nomd),file="QUAC_data_frames\\QUAC_clone_free_md_free.csv")
QUAC_genind_nomd
table(QUAC_genind_nomd@pop)
##output to genalex file
genind2genalex(QUAC_genind_nomd,file="QUAC_data_frames\\QUAC_clone_free_md_free.csv")
#load in relatedness data frame
QUAC_rel_df <- read.csv("QUAC_data_frames\\QUAC_data_frames.csv")
#load in relatedness data frame
QUAC_rel_df <- read.csv("QUAC_data_frames\\QUAC_allpop_clean.csv")
##run relatedness analysis
QUAC_relate_df <- Demerelate(reorg_relatedness, object = T, value = "loiselle")
library(Demerelate)
##run relatedness analysis
QUAC_relatedness_df <- Demerelate(QUAC_rel_df, object = T, value = "loiselle")
##now identify how many individuals have greater than 25% relatedness = half siblings
QUAC_halfsib_names <- names(which(unlist(QUAC_relatedness_df$Empirical_Relatedness) > 0.25))
##now identify how many individuals have greater than 25% relatedness = half siblings
QUAC_halfsib_names <- names(which(unlist(QUAC_relatedness_df$Empirical_Relatedness) > 0.25))
##then use this to create a document which has all the unique individual numbers for every highly related individuals
QUAC_halfsib_names_cleanfront <- gsub("^.*\\.","", QUAC_halfsib_names)
QUAC_halfsib_names_cleanback <- gsub("^.*\\_","", QUAC_halfsib_names_cleanfront)
QUAC_relate_ind_remove <- unique(butternut_halfsib_names_cleanback)
QUAC_relate_ind_remove <- unique(QUAC_halfsib_names_cleanback)
QUAC_relate_ind_remove
length(QUAC_relate_ind_remove)
rownames(QUAC_genind_nomd@tab)
##now limit genind by these names
QUAC_no_halfsib_gen <- QUAC_genind_nomd[!rownames(QUAC_genind_nomd@tab) %in% QUAC_relate_ind_remove,]
##and export to genalex
genind2genalex(QUAC_no_halfsib_gen, file="QUAC_data_frames\\QUAC_no_halfsib.csv")
##now limit genind by these names
QUAC_relate_red_gen <- QUAC_genind_nomd[!rownames(QUAC_genind_nomd@tab) %in% QUAC_relate_ind_remove,]
##and export to genalex
genind2genalex(QUAC_relate_red_gen, file="QUAC_data_frames\\QUAC_relate_red_gen.csv")
##limit data frames
QUAC_red_relate_df <- QUAC_rel_df[!QUAC_rel_df$Ind %in% QUAC_relate_ind_remove,]
View(QUAC_red_relate_df)
##write out file
write.csv(QUAC_red_relate_df, "QUAC_data_frames\\QUAC_red_relate_df.csv")
#####################################
############ Directories ############
#####################################
QUAC_data_files <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_data_files"
QUAC_analysis_results <- "C:\\Users\\eschumacher\\Documents\\GitHub\\QUAC_diversity\\QUAC_analyses\\Results"
library(diveRsity)
setwd(QUAC_data_files)
arp2gen(paste0(QUAC_data_files, "\\QUAC_genind\\QUAC_allpop_clean.arp"))
library(adegenet)
##load in genind for QUAC
QUAC_gen <- read.genepop(paste0(QUAC_data_files, "\\QUAC_genind\\QUAC_allpop_clean.gen"), ncode = 3)
##load in data frame
QUAC_allpop_clean <- read.csv(paste0(QUAC_data_files, "\\QUAC_genind\\QUAC_allpop_data_frame.csv"))
##load in data frame
QUAC_allpop_clean <- read.csv(paste0(QUAC_data_files, "\\QUAC_data_frames\\QUAC_allpop_clean.csv"))
##rename individuals in the genind file
rownames(QUAC_gen@tab) <- QUAC_allpop_clean$ID
##rename population names
QUAC_popnames <- unique(QUAC_allpop_clean$POP)
levels(QUAC_gen@pop) <- QUAC_popnames
##rename population names
QUAC_popnames <- unique(QUAC_allpop_clean$Pop)
levels(QUAC_gen@pop) <- QUAC_popnames
library(hierfstat)
############################################################################
####### Run Genetic Diversity Checks like LD, HWE, Null Alleles  ###########
############################################################################
##calculate null alleles
QUAC_null_all <- null.all(butternutgen_reorg)
library(poppr)
library(Demerelate)
library(adegenet)
library(poppr)
library(hierfstat)
library(PopGenReport)
library(pegas)
############################################################################
####### Run Genetic Diversity Checks like LD, HWE, Null Alleles  ###########
############################################################################
##calculate null alleles
QUAC_null_all <- null.all(butternutgen_reorg)
############################################################################
####### Run Genetic Diversity Checks like LD, HWE, Null Alleles  ###########
############################################################################
##calculate null alleles
QUAC_null_all <- null.all(QUAC_gen)
##create null allele table
QUAC_null_all_df <- matrix(nrow = length(rownames(QUAC_null_all$null.allele.freq$summary1)),
ncol = length(colnames(QUAC_null_all$null.allele.freq$summary1)))
QUAC_null_all_df <- QUAC_null_all_df$null.allele.freq$summary1
QUAC_null_all_df <- QUAC_null_all$null.allele.freq$summary1
View(QUAC_null_all_df)
##load in data frame
QUAC_allpop_clean <- read.csv(paste0(QUAC_data_files, "\\QUAC_data_frames\\QUAC_allpop_clean.csv"))
head(colnames(QUAC_allpop_clean))
length(colnames(QUAC_null_all_df))
length(colnames(QUAC_allpop_clean))
unique(length(colnames(QUAC_allpop_clean)))
##load in genind for QUAC
QUAC_gen <- read.genepop(paste0(QUAC_data_files, "\\QUAC_genind\\QUAC_allpop_clean.gen"), ncode = 3)
############################################################################
####### Run Genetic Diversity Checks like LD, HWE, Null Alleles  ###########
############################################################################
##calculate null alleles
QUAC_null_all <- null.all(QUAC_gen)
##create null allele table
QUAC_null_all_df <- matrix(nrow = length(rownames(QUAC_null_all$null.allele.freq$summary1)),
ncol = length(colnames(QUAC_null_all$null.allele.freq$summary1)))
QUAC_null_all_df <- QUAC_null_all$null.allele.freq$summary1
QUAC_null_all_df
##write out null allele document
write.csv(QUAC_null_all_df, paste0(QUAC_analysis_results, "\\Sum_Stats\\QUAC_null_all_df.csv"))
####calculate HWE deviations
##bn HWE test
QUAC_hwe <- hw.test(butternutgen_reorg, B = 1000)
####calculate HWE deviations
##bn HWE test
QUAC_hwe <- hw.test(QUAC_gen, B = 1000)
####calculate HWE deviations
##bn HWE test
QUAC_hwe_pop <- seppop(QUAC_gen) %>% lapply(hw.test, B = 0)
QUAC_hwe_pop
##create table by populations
QUAC_HWE_allpop_df <- sapply(QUAC_hwe_pop, "[", i = TRUE, j = 3)
##name columns
colnames(QUAC_HWE_allpop_df) <- QUAC_popnames
write.csv(QUAC_HWE_allpop_df, paste0(QUAC_analysis_results, "\\Sum_Stats\\QUAC_HWE_df.csv"))
####calculate HWE deviations
##bn HWE test
QUAC_hwe_pop <- seppop(QUAC_gen) %>% lapply(hw.test, B = 1000)
###calculate linkage disequilibrium
QUAC_ld <- pair.ia(QUAC_gen, sample = 1000)
QUAC_ld_df <- data.frame(round(QUAC_ld,digits = 2))
View(QUAC_ld_df)
write.csv(QUAC_ld_df, paste0(QUAC_analysis_results, "\\Sum_Stats\\QUAC_ld_df.csv"))
?pair.ia
######################################
############# basic stats ############
######################################
##reorg data file
QUAC_summary_gen <- summary(QUAC_gen)
######################################
############# basic stats ############
######################################
##reorg data file
QUAC_summary_gen <- summary(QUAC_gen)
##create poppr file
QUAC_poppr <- poppr(QUAC_gen)
levels(QUAC_gen@pop) <- QUAC_popnames
##create poppr file
QUAC_poppr <- poppr(QUAC_gen)
##expected heterozygosity
QUAC_hexp <- QUAC_poppr[1:22, 10]
##allele numbers by pop
QUAC_nall <- QUAC_summary_gen$pop.n.all
##individual numbers
QUAC_ind <- QUAC_poppr[1:22, 2:3]
##allelic richness code
QUAC_alleles <- QUAC_summary_gen$pop.n.all/length(QUAC_gen@loc.n.all)
QUAC_allrich <- colMeans(allelic.richness(QUAC_gen)$Ar)
##create data frame
QUAC_gendiv_sumstat_df <- signif(cbind(QUAC_ind, QUAC_nall, QUAC_allrich, QUAC_hexp),3)
##name columns and rows
rownames(QUAC_gendiv_sumstat_df) <- QUAC_popnames
colnames(QUAC_gendiv_sumstat_df) <- c("Number of Individuals", "MLG","Number of Alleles", "Allelic Richness", "Expected Heterozygosity")
######################################
############# basic stats ############
######################################
##reorg data file
QUAC_summary_gen <- summary(QUAC_gen)
##create poppr file
QUAC_poppr <- poppr(QUAC_gen)
##expected heterozygosity
QUAC_hexp <- QUAC_poppr[1:22, 10]
##allele numbers by pop
QUAC_nall <- QUAC_summary_gen$pop.n.all
##individual numbers
QUAC_ind <- QUAC_poppr[1:22, 2:3]
##allelic richness code
QUAC_alleles <- QUAC_summary_gen$pop.n.all/length(QUAC_gen@loc.n.all)
QUAC_allrich <- colMeans(allelic.richness(QUAC_gen)$Ar)
##create data frame
QUAC_gendiv_sumstat_df <- signif(cbind(QUAC_ind, QUAC_nall, QUAC_allrich, QUAC_hexp),3)
##name columns and rows
rownames(QUAC_gendiv_sumstat_df) <- QUAC_popnames
colnames(QUAC_gendiv_sumstat_df) <- c("Number of Individuals", "MLG","Number of Alleles", "Allelic Richness", "Expected Heterozygosity")
##write out csv
write.csv(QUAC_gendiv_sumstat_df, paste0(QUAC_analysis_results, "\\Sum_Stats\\QUAC_gendiv_sumstat_df.csv"))
