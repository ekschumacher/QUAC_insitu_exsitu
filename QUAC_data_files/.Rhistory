library(adegenet)
library(hierfstat)
library(geosphere)
library(adegenet)
library(hierfstat)
library(geosphere)
#####################################
############ Directories ############
#####################################
##set directory to all butternut files
QUAC_data_files <- "C:/Users/eschumacher/Documents/GitHub/QUAC_insitu_exsitu/QUAC_data_files"
QUAC_analysis_results <- "C:/Users/eschumacher/Documents/GitHub/QUAC_insitu_exsitu/QUAC_analyses/Results"
################################
########## Load files ##########
################################
setwd(QUAC_data_files)
QUAC_wild_gen <- read.genepop(paste0(QUAC_data_files, "/QUAC_genind/Garden_Wild/QUAC_wild_clean.gen"), ncode = 3)
QUAC_wild_gen <- read.genepop(paste0(QUAC_data_files, "/QUAC_adegenet_files/Garden_Wild/QUAC_wild_clean.gen"), ncode = 3)
QUAC_wild_df <- read.csv(paste0(QUAC_data_files, "/QUAC_data_frames/Garden_Wild/QUAC_wild_clean_df.csv"))
###create population name list
QUAC_pop_list <- unique(QUAC_wild_df$Pop)
QUAC_wild_df
QUAC_pop_list
###rename individuals in genind objects
rownames(QUAC_wild_gen@tab) <- QUAC_wild_df$Ind
##name populations in genind object
levels(QUAC_wild_gen@pop) <- c("Porter", "Magazine", "Pryor", "Sugar Loaf", "Kessler")
##load in data frame with summary stats
QUAC_sumstat_df <- read.csv(paste0(QUAC_analysis_results, "Sum_Stats/wild_gendiv_sumstat_df.csv"))
QUAC_analysis_results
##load in data frame with summary stats
QUAC_sumstat_df <- read.csv(paste0(QUAC_analysis_results, "/Sum_Stats/wild_gendiv_sumstat_df.csv"))
#################################
###### Fst Calculations #########
#################################
##convert to hierfstat format object
QUAC_hierfstat <- genind2hierfstat(QUAC_wild_gen)
##run pairwise fst code
QUAC_fst_df <- pairwise.neifst(QUAC_hierfstat)
QUAC_sumstat_df[1,]
#################################
###### Fst Calculations #########
#################################
##create data frame for just coordinates of each population
QUAC_coords <- QUAC_sumstat_df[,c(1:2)]
View(QUAC_coords)
#################################
###### Fst Calculations #########
#################################
##create data frame for just coordinates of each population
QUAC_coords <- QUAC_sumstat_df[,c(1:3)]
QUAC_coords[,1]
#################################
###### Fst Calculations #########
#################################
##create data frame for just coordinates of each population
QUAC_coords <- QUAC_sumstat_df[,c(2:3)]
QUAC_coords
QUAC_pop_list
##name populations in genind object
levels(QUAC_wild_gen@pop) <- QUAC_pop_list
#################################
###### Fst Calculations #########
#################################
##create data frame for just coordinates of each population
QUAC_coords <- QUAC_sumstat_df[,c(2:3)]
##name every pop
rownames(QUAC_coords) <- QUAC_pop_list
QUAC_coords
##convert to hierfstat format object
QUAC_hierfstat <- genind2hierfstat(QUAC_wild_gen)
##run pairwise fst code
QUAC_fst_df <- pairwise.neifst(QUAC_hierfstat)
##calculate geographic distances between mean locations
QUAC_dist <- matrix(nrow = length(QUAC_pop_list), ncol = length(QUAC_pop_list))
for(first in 1:length(QUAC_pop_list)){
for(second in 1:length(QUAC_pop_list)){
QUAC_dist[first,second] <-  distm(QUAC_coords[first,], QUAC_coords[second,], fun = distGeo)/1000
}
}
##replacce NAs with zeroes
QUAC_dist[is.na(QUAC_dist)] <- 0
QUAC_fst_df[is.na(QUAC_fst_df)] <- 0
##run relationship
QUAC_fst_dist <- lm(QUAC_fst_df[lower.tri(QUAC_fst_df)]~QUAC_dist[lower.tri(QUAC_dist)])
plot(QUAC_fst_df[lower.tri(QUAC_fst_df)]~QUAC_dist[lower.tri(QUAC_dist)], pch = 17, ylim = c(0,0.13),
xlim = c(0,200),
xlab = c("Distance (km)"), ylab = c("Fst"))
abline(QUAC_fst_dist)
legend('bottomleft', legend = c("R2 = -0.12","p-value = 0.865"), bty = 'n')
dev.off()
###test IBD
#convert to genpop object
QUAC_wild_genpop <- genind2genpop(QUAC_wild_gen)
QUAC_gen_dist <- dist.genpop(QUAC_wild_genpop)
QUAC_geo_dist <- dist(QUAC_coords)
QUAC_IBD <- mantel.randtest(QUAC_gen_dist, QUAC_geo_dist) ##not significant
QUAC_gen_dist_lm <- lm(as.numeric(QUAC_gen_dist)~as.numeric(QUAC_geo_dist))
QUAC_gen_dist_lm_sum <- summary(QUAC_gen_dist_lm)
####
plot(QUAC_gen_dist~QUAC_geo_dist)
abline(QUAC_gen_dist_lm, col="red",lty=2)
summary(QUAC_gen_dist_lm)
QUAC_IBD
####
plot(QUAC_gen_dist~QUAC_geo_dist, ylim = c(0,0.3))
abline(QUAC_gen_dist_lm, col="red",lty=2) ##not significant
